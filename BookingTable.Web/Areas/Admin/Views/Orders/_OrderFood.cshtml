@using System.Globalization
@using BookingTable.Web.Helpers
@using BookingTable.Web.Resources
@model BookingTable.Entities.Models.OrderModel
@{
    ViewBag.Title = Resources.Content_Food;
    var locale = new CultureInfo("en-US");
    int numOfTable = Model.TableString.Split(',').Length - 1;
}
<input type="hidden" name="TableString" id="TableString" value="@Model.TableString" />
<input type="hidden" name="TimeString" id="TimeString" value="@Model.TimeString" />
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">×</span>
    </button>
    <h4 class="modal-title">
        @Resources.Content_OrderFood -
    @if (numOfTable > 1)
    {
    @numOfTable
    <text>Tables </text>
    }
    else
    {
    @numOfTable <text>Table </text>
    }
</h4>
</div>
<div class="box-body">
    <!-- /.box-header -->
    <div class="box-body table-responsive">
        <table class="table table-hover" style="overflow:auto; display:inline-block">
            <tbody style="overflow:auto; height:400px; width:100%; display: inline-block;">
                <tr>
                    <th class="text-center" width="150px">#</th>
                    <th width="300px">@Resources.Content_Name</th>
                    <th class="text-center" width="30px">@Resources.Content_Price</th>
                    <th class="text-center" width="30px">@Resources.Content_Quantity</th>
                    <th class="text-center" width="150px">@Resources.Content_Number</th>
                </tr>
                @foreach (var food in Model.FoodList)
                {
                    <tr>
                        <td class="text-center">
                            <a href="javascript:void(0)" class="detailsFood">
                                <img src="@Support.GetPathPhotoFolder()/@food.Image" class="img-responsive img-thumbnail" alt="Cinque Terre" style="width: 70px; height: 70px;">
                            </a>

                        </td>
                        <td>@food.Name</td>
                        <td class="text-center">@food.Price.ToString("c", locale)</td>
                        <td class="text-center"><a href="javascript:void(0)">@food.Quantity</a></td>
                        <td class="text-center">
                            <ul class="pagination pagination-sm no-margin numberFood" data-max="@food.Quantity" data-number="0" data-food-id="@food.Id">
                                <li><a href="javascript:void(0)" class="subone">-</a></li>
                                <li><a href="javascript:void(0)" class="bg-light-blue-active">0</a></li>
                                <li><a href="javascript:void(0)" class="addone">+</a></li>
                            </ul>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">@Resources.Content_Close</button>
    <button type="button" class="btn btn-primary bg-blue btnCreateOrder">@Resources.Content_Orders</button>
</div>
<script>
    $('.subone')
        .click(function() {
            var foodNumber = $(this).parents().parents();
            var value = $(foodNumber).data("number");
            if (value >= @numOfTable) {
                value = value - @numOfTable;
                $(foodNumber).data("number", value);
                foodNumber.children().eq(1).children(0).eq(0).text(value);
            }
        });
    $('.addone')
        .click(function () {
            var foodNumber = $(this).parents().parents();
            var value = $(foodNumber).data("number");
            var max = $(foodNumber).data("max");
            if (value <= max - @numOfTable ) {
                value = value + @numOfTable;
            $(foodNumber).data("number", value);
            foodNumber.children().eq(1).children(0).eq(0).text(value);
        }
    });
    $('.btnCreateOrder')
        .click(function() {
            CreateOrders();
        });

    function CreateOrders() {
        var foodList = [];
        $('.numberFood')
            .each(function () {
                if ($(this).data("number") > 0) {
                    foodList.push({
                        Id: $(this).data("food-id"),
                        Quantity: $(this).data("number")
                    });
                }
            });
        if (foodList.length > 0) {
            var orderModel = {
                TableString: $("#TableString").val(),
                TimeString: $("#TimeString").val(),
                FoodList: foodList
            }

            $.ajax({
                url: "@Url.Action("OrderFood", "Orders")",
                type: "POST",
                data: orderModel,
                success: function(data) {
                    ShowMessage(data);
                    GetTables();
                },
                error: function() {
                    ConnectionError();
                }
            });
        }
    }

</script>
